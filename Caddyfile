# Caddyfile para VPS del Chatbot Xtalento
# Coloca este archivo como "Caddyfile" en el VPS del chatbot

# Dominio del chatbot
bot.xtalento.com.co {
    # SSL autom치tico por Caddy
    
    # Webhook principal del chatbot
    handle /webhook {
        reverse_proxy localhost:8000 {
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
            
            # Timeouts para mensajes largos
            transport http {
                read_timeout 300s
                write_timeout 300s
                dial_timeout 30s
            }
        }
    }
    
    # Endpoints de administraci칩n del chatbot
    handle /healthz {
        reverse_proxy localhost:8000
    }
    
    handle /register_webhook {
        reverse_proxy localhost:8000
    }
    
    handle /check_webhook {
        reverse_proxy localhost:8000
    }
    
    handle /sessions* {
        reverse_proxy localhost:8000
    }
    
    # P치gina de estado b치sica
    handle / {
        respond "游뱄 Xtalento Chatbot - Sistema Operativo" 200
    }
    
    # Logs personalizados
    log {
        output file /var/log/caddy/chatbot.log {
            roll_size 10mb
            roll_keep 5
        }
        format json
    }
}

# Redirecci칩n opcional para www
www.chatbot.midominio.com {
    redir https://chatbot.midominio.com{uri} permanent
}
